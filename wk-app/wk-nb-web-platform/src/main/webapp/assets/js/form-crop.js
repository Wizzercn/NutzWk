var imageCrop=function(){var jcrop_api,jcrop_api2,boundx,boundy,$preview=$('#preview-pane'),$pcnt=$('#preview-pane .preview-container'),$pimg=$('#preview-pane .preview-container img'),xsize=$pcnt.width(),ysize=$pcnt.height();function events(){$('#setSelect').click(function(e){e.preventDefault();jcrop_api2.setSelect(getRandom());});$('#animateTo').click(function(e){e.preventDefault();jcrop_api2.animateTo(getRandom());});$('#release').click(function(e){e.preventDefault();jcrop_api2.release();});$('#disable').click(function(e){e.preventDefault();jcrop_api2.disable();$('#enable').show();$('.requiresjcrop').hide();});$('#enable').click(function(e){e.preventDefault();jcrop_api2.enable();$('#enable').hide();$('.requiresjcrop').show();});$('#rehook').click(function(e){e.preventDefault();$('#rehook,#enable').hide();initJcrop();$('#unhook,.requiresjcrop').show();return false;});$('#unhook').click(function(e){e.preventDefault();jcrop_api2.destroy();$('#unhook,#enable,.requiresjcrop').hide();$('#rehook').show();return false;});$('#img1').click(function(e){e.preventDefault();$(this).addClass('active').closest('.btn-group').find('button.active').not(this).removeClass('active');jcrop_api2.setImage('img/sago.jpg');jcrop_api2.setOptions({bgOpacity:0.6});return false;});$('#img2').click(function(e){e.preventDefault();$(this).addClass('active').closest('.btn-group').find('button.active').not(this).removeClass('active');jcrop_api2.setImage('img/pool.jpg');jcrop_api2.setOptions({bgOpacity:0.6});return false;});$('#img3').click(function(e){e.preventDefault();$(this).addClass('active').closest('.btn-group').find('button.active').not(this).removeClass('active');jcrop_api2.setImage('img/sago.jpg',function(){this.setOptions({bgOpacity:1,outerImage:'img/sagomod.jpg'});this.animateTo(getRandom());});return false;});$('#can_click').change(function(e){e.preventDefault();jcrop_api2.setOptions({allowSelect:!!this.checked});jcrop_api2.focus();});$('#can_move').change(function(e){e.preventDefault();jcrop_api2.setOptions({allowMove:!!this.checked});jcrop_api2.focus();});$('#can_size').change(function(e){e.preventDefault();jcrop_api2.setOptions({allowResize:!!this.checked});jcrop_api2.focus();});$('#ar_lock').change(function(e){e.preventDefault();jcrop_api2.setOptions(this.checked?{aspectRatio:4/3}:{aspectRatio:0});jcrop_api2.focus();});$('#size_lock').change(function(e){e.preventDefault();jcrop_api2.setOptions(this.checked?{minSize:[80,80],maxSize:[350,350]}:{minSize:[0,0],maxSize:[0,0]});jcrop_api2.focus();});}
function updatePreview(c){if(parseInt(c.w)>0){var rx=xsize/c.w;var ry=ysize/c.h;$pimg.css({width:Math.round(rx*boundx)+'px',height:Math.round(ry*boundy)+'px',marginLeft:'-'+ Math.round(rx*c.x)+'px',marginTop:'-'+ Math.round(ry*c.y)+'px'});}}
function initJcrop()
{$('.requiresjcrop').hide();$('#target').Jcrop({onChange:updatePreview,onSelect:updatePreview,aspectRatio:xsize/ysize},function(){var bounds=this.getBounds();boundx=bounds[0];boundy=bounds[1];jcrop_api=this;$preview.appendTo(jcrop_api.ui.holder);});$('#target2').Jcrop({onRelease:releaseCheck},function(){jcrop_api2=this;jcrop_api2.animateTo([100,100,400,300]);$('#can_click,#can_move,#can_size').attr('checked','checked');$('#ar_lock,#size_lock,#bg_swap').attr('checked',false);$('.requiresjcrop').show();});}
function getRandom(){var dim=jcrop_api2.getBounds();return[Math.round(Math.random()*dim[0]),Math.round(Math.random()*dim[1]),Math.round(Math.random()*dim[0]),Math.round(Math.random()*dim[1])];}
function releaseCheck(){jcrop_api2.setOptions({allowSelect:true});$('#can_click').attr('checked',false);}
return{init:function(){events();initJcrop();}};}();$(function(){"use strict";imageCrop.init();});